from collections import Counter

import pickle
import faiss
import pandas as pd

from backend.app.config.config import Config

# Embeddings models names 
LABSE_MODEL_NAME = "sentence-transformers/LaBSE"
PARAPHRASE_MODEL_NAME = "sentence-transformers/paraphrase-multilingual-mpnet-base-v2"
DEBERTA_MODEL_NAME = "microsoft/deberta-large-mnli"

THEMES = [
    "قصيدة اعتذار",
    "قصيدة الاناشيد",
    "قصيدة المعلقات",
    "قصيدة حزينه",
    "قصيدة دينية",
    "قصيدة ذم",
    "قصيدة رثاء",
    "قصيدة رومنسيه",
    "قصيدة سياسية",
    "قصيدة شوق",
    "قصيدة عامه",
    "قصيدة عتاب",
    "قصيدة غزل",
    "قصيدة فراق",
    "قصيدة قصيره",
    "قصيدة مدح",
    "قصيدة هجاء",
    "قصيدة وطنيه"
]

POETS = [
  "آمنة بنت عتيبة",
  "آمنة بنت وهب",
  "أبان الالحقي",
  "أبد الصغير العلوي",
  "أبو الأخيل العجلي",
  "أبو الأسود الدؤلي",
  "أبو البحر الخطي",
  "أبو البقاء الرندي",
  "أبو الحسن الششتري",
  "أبو الحسن بن حريق",
  "أبو الحسن بن خروف",
  "أبو الحسين الجزار",
  "أبو الشمقمق",
  "أبو العباس الجراوي",
  "أبو العلاء المعري",
  "أبو العيناء",
  "أبو الفتح البستي",
  "أبو الفرج الأصبهاني",
  "أبو الفضل الكناني",
  "أبو الفضل الوليد",
  "أبو الفيض الكتاني",
  "أبو القاسم الشابي",
  "أبو المحاسن الشواء",
  "أبو الهدى الصيادي",
  "أبو اليمن الكندي",
  "أبو بكر الخوارزمي",
  "أبو بكر الصديق",
  "أبو بكر بن مجبر",
  "أبو بكر بن مغاور",
  "أبو تمام",
  "أبو جعفر الملاحي",
  "أبو حريز الشريف",
  "أبو دُلامة",
  "أبو ذؤيب الهذلي",
  "أبو زيد الفازازي",
  "أبو طالب",
  "أبو فراس الحمداني",
  "أبو محجن الثقفي",
  "أبو مدين التلمساني",
  "أحلام مستغانمي",
  "أحمد الكيواني",
  "أحمد بامبا",
  "أحمد رامي",
  "أحمد زكي أبو شادي",
  "أحمد شوقي",
  "أحمد محرم",
  "أسامة بن منقذ",
  "أسامه محمد زامل",
  "أم أبي جدابة",
  "أم الأغر بنت ربيعة التغلبية",
  "أم الضحاك المحاربية",
  "أم النحيف",
  "أم موسى الكلابية",
  "أمل دنقل",
  "أمية بن أبي الصلت",
  "أميمة بنت أمية",
  "أميمة بنت عبد المطلب",
  "أنسي الحاج",
  "أوس العبدي",
  "أوس الهجيمي",
  "أوس بن حارثة",
  "إبراهيم الأسطى",
  "إبراهيم الصولي",
  "إبراهيم اليازجي",
  "إبراهيم بن هرمة",
  "إبراهيم طوقان",
  "إبراهيم عبد القادر المازني",
  "إدريس جمّاع",
  "إسماعيل صبري",
  "إلياس أبو شبكة",
  "إيليا ابو ماضي",
  "ابراهيم ناجي",
  "ابن الأبار البلنسي",
  "ابن الأطنابة",
  "ابن الجزري",
  "ابن الجنان",
  "ابن الخياط",
  "ابن الخيمي",
  "ابن الدمينة",
  "ابن الرعلاء",
  "ابن الرومي",
  "ابن الزقاق",
  "ابن الساعاتي",
  "ابن العجلان النهدي",
  "ابن الفارض",
  "ابن المعتز",
  "ابن المُقري",
  "ابن النطروني",
  "ابن النقيب",
  "ابن الوردي",
  "ابن الياسمين",
  "ابن بشري الصقلي",
  "ابن تيمية",
  "ابن جبير الشاطبي",
  "ابن جرج الذهبي",
  "ابن جيا",
  "ابن حجاج",
  "ابن حربون",
  "ابن حزمون",
  "ابن حمديس",
  "ابن حموية",
  "ابن حيوس",
  "ابن حيون",
  "ابن خفاجه",
  "ابن خلدون",
  "ابن داود الظاهري",
  "ابن دراج القسطلي",
  "ابن دريد الأزدي",
  "ابن دنينير",
  "ابن دهن الحصي",
  "ابن رازكه",
  "ابن راشد الحمامي",
  "ابن رشيق القيرواني",
  "ابن رواحة الحموي",
  "ابن زاكور",
  "ابن زريق البغدادي",
  "ابن زمرك",
  "ابن زهر الحفيد",
  "ابن زيدون",
  "ابن سالم الهمداني",
  "ابن سعد البلنسي",
  "ابن سناء الملك",
  "ابن سهل الأندلسي",
  "ابن شكيل",
  "ابن شهاب العلوي",
  "ابن شيخان السالمي",
  "ابن صابر المنجنيقي",
  "ابن طاهر",
  "ابن طفيل",
  "ابن عبد ربه",
  "ابن عطاء الله المصري",
  "ابن علوي الحداد",
  "ابن عمرو الأغماتي",
  "ابن عنين",
  "ابن عياش التجيبي",
  "ابن قلاقس",
  "ابن كسرى",
  "ابن لبال الشريشي",
  "ابن مجاور",
  "ابن مسعود الخشني",
  "ابن مسعود القرطبي",
  "ابن مطروح البلنسي",
  "ابن معتوق",
  "ابن معصوم",
  "ابن مليك الحموي",
  "ابن منجا الدمشقي",
  "ابن مواهب",
  "ابن نباته المصري",
  "ابن نجيب الهاشمي",
  "ابن نفادة",
  "ابن نوفل الحلبي",
  "ابن هانئ الأندلسي",
  "ابو العتاهية",
  "ابو محمد الفقعسي",
  "ابو نواس",
  "احمد مطر",
  "الأبيوردي",
  "الأحنف العكبري",
  "الأحوص الأنصاري",
  "الأخطل",
  "الأرجاني",
  "الأصمعي",
  "الأعشى",
  "الأقرع بن معاذ",
  "الأمير الصنعاني",
  "الأمين العباسي",
  "الإمام الشافعي",
  "الامير منجك باشا",
  "الباخرزي",
  "الباعونية",
  "الببغاء",
  "البحتري",
  "البرعي",
  "البوصيري",
  "التهامي",
  "الجاحظ",
  "الحارث بن حلزة",
  "الحارث بن عباد",
  "الحسين بن علي",
  "الحطيئة",
  "الحلاج",
  "الحيص بيص",
  "الخبز أرز",
  "الخنساء",
  "الراضي بالله",
  "الراعي النميري",
  "الزمخشري",
  "السراج الوراق",
  "السري الرفاء",
  "السمهري العلكي",
  "الشاب الظريف",
  "الشاذلي خزنه دار",
  "الشريف الرضي",
  "الشريف العقيلي",
  "الشريف المرتضى",
  "الشماخ الذبياني",
  "الصاحب بن عباد",
  "الصرصري",
  "الطرماح",
  "الطغرائي",
  "الطفيل الغنوي",
  "العباس بن الأحنف",
  "العباس بن مرداس",
  "العجاج",
  "العجلان بن خليد",
  "العرجي",
  "العقار بن سليل",
  "العنبر الخضم",
  "العوراء الذبيانية",
  "العوراء اليربوعية",
  "الغزالي",
  "الغطمش الضبي",
  "الفارعة بنت معاوية",
  "الفرزدق",
  "الفند الزماني",
  "القاضي الفاضل",
  "القعقاع بن شبث اليهودي",
  "القعقاع بن عمرو",
  "الكذاب الطابخي",
  "الكذاب الكلبي",
  "الكلحبة العرني",
  "الكميت بن زيد",
  "اللواح",
  "المتلمس الضبعي",
  "المتنبي",
  "المتنخل",
  "المثقب العبدي",
  "المثلم الفزاري",
  "المثلم المري",
  "المثلم بن عمرو التنوخي",
  "المثلم بن قرط البلوي",
  "المحيا الهمداني",
  "المرار الكلبي",
  "المرار بن منقذ",
  "المرقش الأصغر",
  "المرقش الأكبر",
  "المسجاح الضبي",
  "المسيب بن علس",
  "المشؤوم",
  "المعان بن روق",
  "المعتمد بن عباد",
  "المفضل النكري",
  "المقنع الكندي",
  "المكزون السنجاري",
  "الملك الأمجد",
  "الممزق العبدي",
  "المنخل اليشكري",
  "المنفلوطي",
  "الميكالي",
  "النابغة التغلبي",
  "النابغة الجعدي",
  "النابغة الحارثي",
  "النابغة الذبياني",
  "النابغة الشيباني",
  "النابغة الغنوي",
  "النوار الجل",
  "الهبل",
  "الهبل بن عامر",
  "الهجرس التغلبي",
  "الهدم بن امرئ القيس",
  "الهذلول بن كعب",
  "الهذيل الأكبر التغلبي",
  "الهذيل بن أم عفاش",
  "الهيبان الفهمي",
  "الهيفاء بنت صبيح القضاعية",
  "الوأواء الدمشقي",
  "الوقي الهمداني",
  "الوليد بن يزيد",
  "امرؤ القيس",
  "امرؤ القيس الزهيري",
  "امرؤ القيس السكوني",
  "امرؤ القيس الكلبي",
  "بداء بن سليمان",
  "بدر الفزاري",
  "بدر شاكر السياب",
  "بديع الزمان الهمذاني",
  "بديع القشاعلة",
  "برة بنت عبد المطلب",
  "بسام بن شريح",
  "بشار بن برد",
  "بشامة بن الغدير",
  "بشر الفزاري",
  "بشر بن أبي خازم",
  "بشر بن عمرو",
  "بشير بن النكث",
  "بطرس كرامة",
  "بغثر بن لقيط الأسدي",
  "بكر الجرهمي",
  "بلبل الغرام الحاجري",
  "بلعاء بن قيس الكناني",
  "بلند الحيدري",
  "بنت الشحنة",
  "بهاء الدين الصيادي",
  "بهاء الدين زهير",
  "بيهس الغطفاني",
  "بيهس الفزاري",
  "تأبط شراً",
  "تماضر بنت الشريد",
  "تميم البرغوثي",
  "تميم الفاطمي",
  "تنها بنت قرط العبدية",
  "توبة الخفاجي",
  "توفيق زياد",
  "ثعلبة المازني",
  "ثعلبة بن بكر الأزدي",
  "ثعلبة بن عامر",
  "جابر المرني",
  "جابر المري",
  "جاسم الصحيح",
  "جبار الفزاري",
  "جبار بن قرط",
  "جبر المعاوي",
  "جبران خليل جبران",
  "جبلة بن الحارث",
  "جبيهاء الأشجعي",
  "جحدر الوائلي",
  "جحيش الهمداني",
  "جرمانوس فرحات",
  "جرير",
  "جساس بن مرة",
  "جلواح",
  "جميل بثينة",
  "جميل صدقي الزهاوي",
  "جورج جرداق",
  "جورج جريس فرح",
  "حافظ ابراهيم",
  "حبيب الهلالي",
  "حذيفة العرجي",
  "حسان بن ثابت",
  "حسن كامل الصيرفي",
  "حفني ناصف",
  "حمد بن خليفة أبو شهاب",
  "حمزة الملك طمبل",
  "خالد الفرج",
  "خفاف بن ندبة السلمي",
  "خليل مردم بك",
  "خليل مطران",
  "دريد بن الصمة",
  "دعبل الخزاعي",
  "دويد القضاعي",
  "ديك الجن",
  "ذو الرمة",
  "رفعت الصليبي",
  "زكي مبارك",
  "زهير بن أبي سلمى",
  "زياد التميمي",
  "زياد السعودي",
  "سالم أبو جمهور القبيسي",
  "سامي المالكي",
  "سبط ابن التعاويذي",
  "سعيد بن أحمد البوسعيدي",
  "سعيد عقل",
  "سلطان السبهان",
  "سلم الخاسر",
  "سليم عبدالقادر",
  "سليمان الباروني",
  "سليمان بن سحمان",
  "سميح القاسم",
  "سهام آل براهمي",
  "سيد قطب",
  "سيف الدولة الحمداني",
  "سيف الرحبي",
  "شاعر الحمراء",
  "شريف بقنه",
  "شمر الحنفي",
  "صالح الشرنوبي",
  "صالح الفهدي",
  "صخر الغي",
  "صردر",
  "صريع الغواني",
  "صفي الدين الحلي",
  "صلاح الدين الصفدي",
  "صلاح عبد الصبور",
  "ضرار الفهري",
  "طرفة بن العبد",
  "ظافر الحداد",
  "عارف الخاجة",
  "عباس بن فرناس",
  "عبد الرحمن بن مساعد",
  "عبد الرزاق عبد الواحد",
  "عبد الغفار الأخرس",
  "عبد الغني النابلسي",
  "عبد القادر الجزائري",
  "عبد المجيد الأزدي",
  "عبد المحسن الصوري",
  "عبد الناصر الجوهري",
  "عبد الولي الشميرى",
  "عبدالرحمن العشماوي",
  "عبدالله البردوني",
  "عبدالله الشبراوي",
  "عبدالله الفيصل",
  "عبده صالح",
  "عبيد بن الأبرص",
  "عدنان الصائغ",
  "عدي بن الرقاع",
  "عدي بن ربيعة",
  "عروة بن أذينة",
  "عروة بن الورد",
  "عروة بن حزام",
  "علقمة الفحل",
  "علي بن أبي طالب",
  "علي بن سعود آل ثاني",
  "عمارة اليمني",
  "عمر أبو ريشة",
  "عمر الأنسي",
  "عمر الخيام",
  "عمر اليافي",
  "عمر بن أبي ربيعة",
  "عمر محمد عبدالرحمن",
  "عمرو الباهلي",
  "عمرو بن كلثوم",
  "عمرو بن معد يكرب",
  "عنترة بن شداد",
  "غازي الجمل",
  "غازي القصيبي",
  "فؤاد الخطيب",
  "فاروق جويدة",
  "فاطمة الزهراء",
  "فتيان الشاغوري",
  "فهد العسكر",
  "قاسم حداد",
  "قسطاكي الحمصي",
  "قيس بن الملوح",
  "قيس بن ذريح",
  "قيس بن زهير",
  "كثير عزة",
  "كريم معتوق",
  "كشاجم",
  "كعب بن زهير",
  "لبيد بن ربيعة",
  "لسان الدين بن الخطيب",
  "ماء العينين",
  "مالك الأشتر",
  "محمد الثبيتي",
  "محمد الشوكاني",
  "محمد المعولي",
  "محمد بن عبود العمودي",
  "محمد عبد الباري",
  "محمد فضولي",
  "محمد مهدي الجواهري",
  "محمد ولد ابن ولد أحميدا",
  "محمود الوراق",
  "محمود درويش",
  "محمود سامى البارودى",
  "محمود قابادو",
  "مدثر بن إبراهيم بن الحجاز",
  "مروان بن أبي حفصة",
  "مسكين الدرامي",
  "مصطفى التل",
  "مصطفى بن زكري",
  "مصطفى صادق الرافعي",
  "مطلق عبد الخالق",
  "معروف الرصافي",
  "مهيار الديلمي",
  "مَحمد اسموني",
  "نازك الملائكة",
  "ناصيف اليازجي",
  "نزار قباني",
  "نسيب عريضة",
  "نصيب بن رباح",
  "نوري سراج الوائلي",
  "هشام الجخ",
  "هلال بن سعيد العماني",
  "هند بنت عتبة",
  "وضاح اليمن",
  "ولادة بنت المستكفي",
  "يزيد بن الطثرية",
  "يزيد بن معاوية",
  "يوسف النبهاني",
]

NUMBER_TO_ORDINAL = {
    1: "الأولى",
    2: "الثانية",
    3: "الثالثة",
    4: "الرابعة",
    5: "الخامسة",
    6: "السادسة",
    7: "السابعة",
    8: "الثامنة",
    9: "التاسعة",
    10: "العاشرة"
}

METERS_SCORES = {
    "الرجز": 2,
    "الكامل": 2,
    "الوافر": 2,
    "نثر": 1,
}

QAWAFI_RHYMES = [
    "قافية الميم",  # Mīm
    "قافية النون",  # Nūn
    "قافية اللام",  # Lām
    "قافية الهاء",
    "قافية الألف",  # Alif
    "قافية السين",  # Sīn
    "قافية الياء",  # Yā'
    "قافية الراء",  # Rā'
]

QAWAFI_WEIGHTS = [
    0.30,
    0.30,
    0.10,
    0.10,
    0.05,
    0.05,
    0.05,
    0.05,
]

def int_to_arabic(number):
    arabic_numerals = '٠١٢٣٤٥٦٧٨٩'
    return ''.join(arabic_numerals[int(d)] for d in str(number))

def log_message(msg, level):
   """
   args:
      msg: string text to be logged to stdout
      level: 1 for user pretty output, 2 for adding intermediate steps
   """
   if level <= Config.LOGGER_LEVEL:
      print(msg, flush=True)

def load_embeddings(path):
  with open(path, 'rb') as f:
      embeddings = pickle.load(f)

  # Normalize the embeddings
  faiss.normalize_L2(embeddings)

  # Create a FAISS index
  index = faiss.IndexFlatIP(embeddings.shape[1])
  index.add(embeddings)

  return index

def load_db(path):
  df = pd.read_csv(path)
  return df

def majority_vote(a):
  return Counter(a).most_common()[0][0]